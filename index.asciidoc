Trinotate: Transcriptome Functional Annotation and Analysis
===========================================================

image::images/TrinotateLogo.png[Trinotate image]

:numbered!:


[NOTE]
.Trinotate Breaking News
========================
- Feb, 2015: Trinotate moves to Github
- Feb, 2015: Trinotate release v2.0 is now available (see below)
- Feb, 2015: link:TrinotateWeb.html[TrinotateWeb] is becoming more useful, the interface was given a facelift including other various performance improvements.
========================


== Background ==

Trinotate is a comprehensive annotation suite designed for automatic functional annotation of transcriptomes, particularly de novo assembled transcriptomes, from model or non-model organisms. Trinotate makes use of a number of different well referenced methods for functional annotation including homology search to known sequence data (BLAST+/SwissProt/Uniref90), protein domain identification (HMMER/PFAM), protein signal peptide and transmembrane domain prediction (singalP/tmHMM), and comparison to currently curated annotation databases (EMBL Uniprot eggNOG/GO Pathways databases). All functional annotation data derived from the analysis of transcripts is integrated into a SQLite database which allows fast efficient searching for terms with specific qualities related to a desired scientific hypothesis or a means to create a whole annotation report for a transcriptome.

[NOTE]
Trinotate now includes link:TrinotateWeb.html[TrinotateWeb], which provide a graphical interface for navigating transcriptome annotations and analyzing transcript expression and differential expression using the Trinity/RSEM/Bioconductor analysis framework. 

image::images/trinityWebLogo.png["TrinityWeb logo", width=350]


:numbered:

== Table of Contents ==

- <<SoftwareRequired, Software and Data Required>>
- <<SequencesRequired, Sequence Databases Required>>
- <<SeqAnalyses, Running Sequence Analyses>>
- <<LoadingSQLite, Trinotate: Loading results into an SQLite database>>
- <<OutputReport, Trinotate: Output an annotation report>> 
- <<SampleData, Trinotate: Sample data and execution>>
- <<LitRefs, Literature references for software leveraged for functional annotation>>
- <<Contact, Contact us>>

[[SoftwareRequired]]
= Software and Data Required =

== Software Required ==

- Trinotate
'http://trinotate.github.io' https://github.com/Trinotate/Trinotate/releases[download Trinotate]


- Trinity (includes TransDecoder and support for expression and DE analysis using RSEM and Bioconductor):
'http://trinityrnaseq.github.io/' https://github.com/trinityrnaseq/trinityrnaseq/releases[download Trinity].

- sqlite (required for database integration):
http://www.sqlite.org/

- NCBI BLAST+: Blast database Homology Search:
http://www.ncbi.nlm.nih.gov/books/NBK52640/

- HMMER/PFAM Protein Domain Identification:
http://hmmer.janelia.org/download.html

Below are optional but recommended:

- signalP v4 (free academic download)
http://www.cbs.dtu.dk/cgi-bin/nph-sw_request?signalp

  You should edit the following line to read like so, increasing the max number of entries that can be processed:
  my $MAX_ALLOWED_ENTRIES=2000000;  # default is only 2000


- tmhmm v2 (free academic download)
http://www.cbs.dtu.dk/cgi-bin/nph-sw_request?tmhmm

  You might need to edit the header lines of the scripts 'tmhmm' and 'tmhmmformat.pl' to read:
  #!/usr/bin/env perl

- RNAMMER (free academic download)
http://www.cbs.dtu.dk/cgi-bin/sw_request?rnammer

  Installation notes:
  RNAMMER requires the older version of hmmsearch (v2).  
  You can obtain the hmmsearch_v2 at ftp://selab.janelia.org/pub/software/hmmer/2.3.2/hmmer-2.3.2.tar.gz[ftp://selab.janelia.org/pub/software/hmmer/2.3.2/hmmer-2.3.2.tar.gz].
  After building the software, we suggest you rename this version of hmmsearch as 'hmmsearch2'.

  In the 'rnammer' software configuration, edit the rnammer script to point
  $HMMSEARCH_BINARY = "/path/to/hmmsearch2";

  Be sure that rnammer functions correctly by executing it on their provided sample data.  RNAMMER is quite useful, but the current implementation is not robust to error, so check carefully.


[[SequencesRequired]]
== Sequence Databases Required ==

Trinotate is built around specific releases of SwissProt and Pfam, and custom protein files are generated for use with Trinotate. It is imperative that these protein files are searched in order to maintain Trinotate compatibility; this is primarily because the UniprotKB identifiers are used as the protein accessions.  You can obtain the protein database files as the links below:

SwissProt
ftp://ftp.broadinstitute.org/pub/Trinity/Trinotate_v2.0_RESOURCES/uniprot_sprot.trinotate_v2.0.pep.gz[Download SwissProt here]

    be sure the search database is uncompressed and properly formatted by running the following (requires that blast+ is already installed as indicated above)
    mv uniprot_sprot.trinotate_v2.0.pep.gz uniprot_sprot.trinotate.pep.gz
    gunzip uniprot_sprot.trinotate.pep.gz
    makeblastdb -in uniprot_sprot.trinotate.pep -dbtype prot

Uniref90
ftp://ftp.broadinstitute.org/pub/Trinity/Trinotate_v2.0_RESOURCES/uniprot_uniref90.trinotate_v2.0.pep.gz[Download Uniref90 here]

    mv uniprot_uniref90.trinotate_v2.0.pep.gz uniprot_uniref90.trinotate.pep.gz
    gunzip uniprot_uniref90.trinotate.pep.gz
    makeblastdb -in uniprot_uniref90.trinotate.pep -dbtype prot

Pfam domains
ftp://ftp.broadinstitute.org/pub/Trinity/Trinotate_v2.0_RESOURCES/Pfam-A.hmm.gz[Download Pfam-A here]

   Uncompress and prepare it for use with 'hmmscan' like so:
   gunzip Pfam-A.hmm.gz
   hmmpress Pfam-A.hmm

[[SeqAnalyses]]
= Running Sequence Analyses =

Both the Trinity-assembled transcripts and any predicted protein-coding regions are subject to analysis using the various strategies below.

Trinity transcripts are searched for sequence homologies using BLASTX, and RNAMMER is used to identify potential rRNA transcripts.

Transdecoder-predicted coding regions are also searched for sequence homologies using BLASTP, protein domains identified via a Pfam search, and additional properties such as signal peptides and likely transmembrane-spanning regions are explored.


== Files needed for execution ==


- 'Trinity.fasta' - Final product containing all the transcripts assembled by Trinity

- 'Trinity.fasta.transdecoder.pep' - Most likely Longest-ORF peptide candidates generated from the Trinity Assembly. Instructions for generation of this file can be found here: http://transdecoder.github.io/[http://transdecoder.github.io/]


== Capturing BLAST Homologies ==

image::images/BLAST.png[Blast image]

BLAST information 
Instructions for installation of command line stand alone blast can be found here:
http://www.ncbi.nlm.nih.gov/books/NBK52640/ 
NOTE: This step will undoubtedly take the longest, for very large files execution on a multi-cpu server HPC environment is highly recommended, and your thread count should be equal to the number of CPU's present on the node the job is run on.


[width="100%",options="header"]
|======================================================================================================
| Blast Commands
|
| # search Trinity transcripts
| blastx -query Trinity.fasta -db uniprot_sprot.trinotate.pep -num_threads 8 -max_target_seqs 1 -outfmt 6 > blastx.outfmt6
|
| # search Transdecoder-predicted proteins
|
| blastp -query transdecoder.pep -db uniprot_sprot.trinotate.pep  -num_threads 8 -max_target_seqs 1 -outfmt 6 > blastp.outfmt6
|
| # Optional: perform similar searches using uniref90 as the target database, rename output files accordingly.
|
|      blastx -query Trinity.fasta -db uniprot_uniref90.trinotate.pep -num_threads 8 -max_target_seqs 1 -outfmt 6 > uniref90.blastx.outfmt6
|
|      blastp -query transdecoder.pep -db uniprot_uniref90.trinotate.pep -num_threads 8 -max_target_seqs 1 -outfmt 6 > uniref90.blastp.outfmt6
|
|======================================================================================================
NOTE: num_threads should be equal to the amount of cores available

[NOTE]
If you have access to a compute farm running LSF, SGE, PBS, or SLURM, consider using http://HpcGridRunner.github.io[HPC GridRunner] to maximally parallelize your blast searches. 


== Running HMMER to identify protein domains ==

image::images/HMMER.PNG[HMMER image]

[width="100%",options="header"]
|==============================================
| hmmscan (HMMER) command:    
|
| hmmscan --cpu 8 --domtblout TrinotatePFAM.out Pfam-A.hmm transdecoder.pep > pfam.log
|
|==============================================

NOTE: num_threads should be equal to the number of cores available


== Running signalP to predict signal peptides ==

image::images/signalP.PNG[SIGNALP image]

[width="100%",options="header"]
|==============================================
| signalP command:    
|
| signalp -f short -n signalp.out transdecoder.pep
|
|==============================================

== Running tmHMM to predict transmembrane regions ==

image::images/tmhmm.PNG[TMHMM image]

[width="100%",options="header"]
|==============================================
| tmhmm command:    
|
| tmhmm --short < transdecoder.pep > tmhmm.out
|
|==============================================


== Running RNAMMER to identify rRNA transcripts ==

image::images/rnammer.png[RNAMMER image]

RNAMMER was originally developed to identify rRNA genes in genomic sequences.  To have it identify rRNA sequences among our large sets of transcriptome sequences, we first concatenate all the transcripts together into a single super-scaffold, run RNAMMER to identify rRNA homologies, and then transform the rRNA feature coordinates in the super-scaffold back to the transcriptome reference coordinates.  The following script will perform all of these operations:

  $TRINOTATE_HOME/util/rnammer_support/RnammerTranscriptome.pl 

 ################################################################################
 #
 #  --transcriptome <string>      Transcriptome assembly fasta file
 #
 #  --path_to_rnammer <string>    Path to the rnammer software 
 #                                (ie.  /usr/bin/software/rnammer_v1.2/rnammer)
 #
 #  Optional:
 # 
 #  --org_type <string>           arc|bac|euk   (default: euk)
 #
 ################################################################################


And so, you might execute it like so:

   $TRINOTATE_HOME/util/rnammer_support/RnammerTranscriptome.pl --transcriptome Trinity.fasta --path_to_rnammer /usr/bin/software/rnammer_v1.2/rnammer

Once complete, it will have generated a file: 'Trinity.fasta.rnammer.gff', which can be loaded into Trinotate as described in sections below.


[[LoadingSQLite]]
= Trinotate: Loading Above Results into a Trinotate SQLite Database =

The following commands will import the results from the bioinformatic computes performed above into a Trinotate SQLite database. All operations are performed using the included 'Trinotate' utility.  Usage is like so:



   usage: ./Trinotate <sqlite.db> <command> <input> [...]


     <commands>: 

         * Initial import of transcriptome and protein data:

             init --gene_trans_map <file> --transcript_fasta <file> --transdecoder_pep <file>

         * Transdecoder protein search results:

             LOAD_swissprot_blastp <file>
             LOAD_trembl_blastp <file>
             LOAD_pfam <file>
             LOAD_tmhmm <file>
             LOAD_signalp <file>

          * Trinity transcript search results:

             LOAD_swissprot_blastx <file>
             LOAD_trembl_blastx <file>
             LOAD_rnammer <file>
             
          * report generation:

             report [ -E (default: 1e-5) ] [--pfam_cutoff DNC|DGC|DTC|SNC|SGC|STC (default: DNC=domain noise cutoff)]



Follow the steps below to obtain a boilerplate Trinotate sqlite database and populate it with your data.


== Retrieve the Trinotate Pre-generated Resource SQLite database ==

A pregenerated sqlite database that contains Uniprot(swissprot and uniref90)-related annotation information is available from the Trinity ftp site. Pull it down like so:

   wget "ftp://ftp.broadinstitute.org/pub/Trinity/Trinotate_v2.0_RESOURCES/Trinotate.sprot_uniref90.20150131.boilerplate.sqlite.gz" -O Trinotate.sqlite.gz


Uncompress it like so:

   gunzip Trinotate.sqlite.gz

[NOTE]
The boilerplate Trinotate.sqlite database downloaded above is specific to each software release.  The link above will retrieve the sqlite database that is compatible with this current software version (Feb, 2015).


== Load transcripts and coding regions  ==

Begin populating the sqlite database by loading three data types:

- Transcript sequences (de novo assembled transcripts or reference transcripts)
- Protein sequences (currently as defined by TransDecoder)
- Gene/Transcript relationships (tab delimited format: "gene_id(tab)transcript_id", same as used by the RSEM software).  If you are using Trinity assemblies, you can generate this file like so: 

     $TRINITY_HOME/util/support_scripts/get_Trinity_gene_to_trans_map.pl Trinity.fasta >  Trinity.fasta.gene_trans_map

Load these info into the Trinotate sqlite database like so (example, using Trinity assemblies):

   Trinotate Trinotate.sqlite init --gene_trans_map Trinity.fasta.gene_trans_map --transcript_fasta Trinity.fasta --transdecoder_pep transdecoder.pep


== Loading BLAST homologies ==

 # load protein hits
 Trinotate Trinotate.sqlite LOAD_swissprot_blastp blastp.outfmt6

 # load transcript hits
 Trinotate Trinotate.sqlite LOAD_swissprot_blastx blastx.outfmt6

Optional: load Uniref90 blast hits (requires the more comprehensive boilerplate database, as described above):

 # load protein hits
 Trinotate Trinotate.sqlite LOAD_trembl_blastp uniref90.blastp.outfmt6

 # load transcript hits
 Trinotate Trinotate.sqlite LOAD_trembl_blastx uniref90.blastx.outfmt6


== Load Pfam domain entries ==

 Trinotate Trinotate.sqlite LOAD_pfam TrinotatePFAM.out

== Load transmembrane domains ==

 Trinotate Trinotate.sqlite LOAD_tmhmm tmhmm.out

== Load signal peptide predictions ==

 Trinotate Trinotate.sqlite LOAD_signalp signalp.out

[[OutputReport]]
= Trinotate: Output an Annotation Report =

 Trinotate Trinotate.sqlite report [opts] > trinotate_annotation_report.xls

Note, you can threshold the blast and pfam results to be reported by including the options below:

 ##################################################################
 #
 #  -E <float>                 maximum E-value for reporting best blast hit
 #                             and associated annotations.
 #
 #  --pfam_cutoff <string>     'DNC' : domain noise cutoff (default)
 #                             'DGC' : domain gathering cutoff
 #                             'DTC' : domain trusted cutoff
 #                             'SNC' : sequence noise cutoff
 #                             'SGC' : sequence gathering cutoff
 #                             'STC' : sequence trusted cutoff
 #
 ##################################################################


The output has the following column headers:

 0       #gene_id
 1       transcript_id
 2       Top_BLASTX_hit
 3       RNAMMER
 4       prot_id
 5       prot_coords
 6       Top_BLASTP_hit
 7       Pfam
 8       SignalP
 9       TmHMM
 10      eggnog
 11      gene_ontology


and the data are formatted like so:

 # example protein-coding transcript
 0       comp66_c0
 1       comp66_c0_seq1
 2       sp|Q09739|MCP7_SCHPO^Q09739^Q:1-519,H:15-187^100%ID^E:5e-95^RecName: Full=Meiotic coiled-coil protein 7; AltName: Full=Meiotically up-regulated gene 32 protein;^Eukaryota; Fungi; Dikarya; Ascomycota; Taphrinomycotina; Schizosaccharomycetes; Schizosaccharomycetales; Schizosaccharomycetaceae; Schizosaccharomyces.
 3       .
 4       m.4
 5       1-522[+]
 6       sp|Q5XGY9|MND1_XENLA^Q5XGY9^Q:4-169,H:19-181^37.13%ID^E:7e-24^RecName: Full=Meiotic nuclear division protein 1 homolog;^Eukaryota; Metazoa; Chordata; Craniata; Vertebrata; Euteleostomi; Amphibia; Batrachia; Anura; Pipoidea; Pipidae; Xenopodinae; Xenopus; Xenopus.`sp|Q9BWT6|MND1_HUMAN^Q9BWT6^Q:4-169,H:19-181^38.32%ID^E:1e-23^RecName: Full=Meiotic nuclear division protein 1 homolog;^Eukaryota; Metazoa; Chordata; Craniata; Vertebrata; Euteleostomi; Mammalia; Eutheria; Euarchontoglires; Primates; Haplorrhini; Catarrhini; Hominidae; Homo.`sp|Q32L19|MND1_BOVIN^Q32L19^Q:4-169,H:19-181^38.92%ID^E:3e-23^RecName: Full=Meiotic nuclear division protein 1 homolog;^Eukaryota; Metazoa; Chordata; Craniata; Vertebrata; Euteleostomi; Mammalia; Eutheria; Laurasiatheria; Cetartiodactyla; Ruminantia; Pecora; Bovidae; Bovinae; Bos.`sp|Q6DC61|MND1_DANRE^Q6DC61^Q:4-158,H:19-170^40.13%ID^E:3e-23^RecName: Full=Meiotic nuclear division protein 1 homolog;^Eukaryota; Metazoa; Chordata; Craniata; Vertebrata; Euteleostomi; Actinopterygii; Neopterygii; Teleostei; Ostariophysi; Cypriniformes; Cyprinidae; Danio.`sp|Q8GYD2|MND1_ARATH^Q8GYD2^Q:4-168,H:19-179^40.36%ID^E:3e-22^RecName: Full=Meiotic nuclear division protein 1 homolog; Short=AtMND1; AltName: Full=Meiotic nuclear division 1-like protein;^Eukaryota; Viridiplantae; Streptophyta; Embryophyta; Tracheophyta; Spermatophyta; Magnoliophyta; eudicotyledons; core eudicotyledons; rosids; malvids; Brassicales; Brassicaceae; Camelineae; Arabidopsis.
 7       PF03962.10^Mnd1^Mnd1 family^1-170^E:1.9e-51
 8       .
 9       .
 10      .
 11      GO:0005634^cellular_component^nucleus`GO:0006310^biological_process^DNA recombination`GO:0007126^biological_process^meiosis


 # Example rRNA entry

 0   comp4721_c0
 1   comp4721_c0_seq1
 2   .
 3   18s_rRNA^1294-3134
 4   .
 5   .
 6   .
 7   .
 8   .
 9   .
 10  .
 11  .



Backticks (\`) and carets (\^) are used as delimiters for data packed within an individual field, such as separating E-values, percent identity, and taxonomic info for best matches. When there are multiple assignments in a given field, the assignments are separated by (\`) and the fields within an assignment are separated by (\^).  In a future release (post Feb-2013), the backticks and carets will be used more uniformly than above, such as carets as BLAST field separators, and including more than the top hit.

[[SampleData]]
= Trinotate: Sample data and execution =

Sample data and a 'runMe.sh' script are available at $TRINOTATE_HOME/sample_data/

Executing the 'runMe.sh' script will pull down the Trinotate sqlite database, populate with the provided bioinformatics computes, and generate the final Trinotate annotation report.  In addition, pre-computed expression and DE analyses will be loaded for use with TrinotateWeb.

[[LitRefs]]
= Literature references for software used for functional annotation =
[bibliography]
- [[[Trinity]]]Full-length transcriptome assembly from RNA-Seq data without a reference genome.
Grabherr MG, Haas BJ, Yassour M, Levin JZ, Thompson DA, Amit I, Adiconis X, Fan L,
Raychowdhury R, Zeng Q, Chen Z, Mauceli E, Hacohen N, Gnirke A, Rhind N, di Palma F,
Birren BW, Nusbaum C, Lindblad-Toh K, Friedman N, Regev A.
Nature Biotechnology 29, 644â652 (2011)

- [[[HMMER]]]HMMER web server: interactive sequence similarity searching
R.D. Finn, J. Clements, S.R. Eddy
Nucleic Acids Research (2011) Web Server Issue 39:W29-W37.

- [[[PFAM]]] The Pfam protein families database
Punta, P.C. Coggill, R.Y. Eberhardt, J. Mistry, J. Tate, C. Boursnell, N. Pang, K. Forslund, 
Ceric, J. Clements, A. Heger, L. Holm, E.L.L. Sonnhammer, S.R. Eddy, A. Bateman, R.D. Finn
Nucleic Acids Research (2012) Database Issue 40:D290-D301

- [[[SignalP]]]SignalP 4.0: discriminating signal peptides from transmembrane regions
Thomas Nordahl Petersen, Soren Brunak, Gunnar von Heijne & Henrik Nielsen
Nature Methods, 8:785-786, 2011

- [[[tmHMM]]]Predicting transmembrane protein topology with a hidden Markov model: application to complete genomes.
Krogh A, Larsson B, von Heijne G, Sonnhammer EL.
J Mol Biol. 2001 Jan 19;305(3):567-80.

- [[[BLAST]]]Basic local alignment search tool.
Altschul SF; Gish W; Miller W; Myers EW; Lipman DJ
J Mol Biol 215: 403-10 (1990)

- [[[KEGG]]]KEGG for integration and interpretation of large-scale molecular datasets.
Kanehisa, M., Goto, S., Sato, Y., Furumichi, M., and Tanabe, M.;
Nucleic Acids Res. 40, D109-D114 (2012).

- [[[GO]]]Gene Ontology: tool for the unification of biology.
The Gene Ontology Consortium
Nature Genet. 25: 25-29 (2000)

- [[[eggNOG]]]eggNOG v3.0: orthologous groups covering 1133 organisms at 41 different taxonomic ranges.
Powell S, Szklarczyk D, Trachana K, Roth A, Kuhn M, Muller J, Arnold R, Rattei T, Letunic I,
Doerks T, Jensen LJ, von Mering C, Bork P.
Nucleic Acids Res. 2012 Jan;40(Database issue):D284-9. Epub 2011 Nov 16.

- [[[RNAMMER]]] RNammer: consistent annotation of rRNA genes in genomic sequences
Lagesen K, Hallin PF, Rodland E, Staerfeldt HH, Rognes T Ussery DW 
Nucleic Acids Res. 2007 Apr 22. 

:numbered!: 

[[Contact]]
Contact Us
----------

User support for Trinotate is provided at the Trinotate Google Group: https://groups.google.com/forum/?hl=en\#!forum/trinotate-users[https://groups.google.com/forum/?hl=en#!forum/trinotate-users]

